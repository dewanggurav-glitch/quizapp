<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }

        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: rgb(176, 255, 244);
        }

        .quiz-container {
            width: 100%;
            max-width: 600px;
            padding: 20px;
            text-align: center;
        }

        .question-box {
            border: 2px solid #000;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 30px;
            background-color: rgb(89, 243, 110);
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }

        .option {
            width: 100%;
            max-width: 350px;
            padding: 12px;
            border: 2px solid #000;
            border-radius: 10px;
            background: #fff;
            cursor: pointer;
            font-size: 16px;
        }

        .option:hover {
            background: #eaeaea;
        }

        .option.selected {
            background-color: #cce5ff;
            border-color: #007bff;
        }

        .option.correct {
            background-color: #9dff9d;
            border-color: green;
        }

        .option.wrong {
            background-color: #ffb3b3;
            border-color: red;
        }

        .submit-btn {
            margin-top: 30px;
            padding: 12px 30px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            background: black;
            color: white;
            cursor: pointer;
        }

        .submit-btn:hover {
            opacity: 0.8;
        }
    </style>
</head>

<body>

    <div class="quiz-container">

        <div class="question-box">
            <h2 id="questionText">Loading question...</h2>
        </div>

        <div class="options">
            <button class="option" data-answer="A" id="optA"></button>
            <button class="option" data-answer="B" id="optB"></button>
            <button class="option" data-answer="C" id="optC"></button>
            <button class="option" data-answer="D" id="optD"></button>
        </div>

        <button class="submit-btn" onclick="submitAnswer()">Submit</button>

    </div>

    <script>
        let index = 0;
        let category = localStorage.getItem("selectedCategory");

        if (!category) {
            alert("No category selected!");
            window.location.href = "category.html";
        }
        // change to history, gk, it, ca
        let correctAnswer = "";
        let selectedOption = null;
        let score = 0;

        const questionText = document.getElementById("questionText");
        const options = document.querySelectorAll(".option");

        function loadQuestion() {
            fetch(`http://localhost:5000/quiz/question?category=${category}&index=${index}`)

                .then(res => res.json())
                .then(data => {
                    if (data.status === "end") {
                        finishQuiz();
                        return;
                    }

                    // reset state
                    selectedOption = null;
                    options.forEach(opt => {
                        opt.classList.remove("selected", "correct", "wrong");
                        opt.disabled = false;
                    });

                    // set question
                    questionText.innerText = `Q${index + 1}. ${data.question.question}`;

                    // set options
                    document.getElementById("optA").innerText = "A. " + data.question.option_a;
                    document.getElementById("optB").innerText = "B. " + data.question.option_b;
                    document.getElementById("optC").innerText = "C. " + data.question.option_c;
                    document.getElementById("optD").innerText = "D. " + data.question.option_d;

                    correctAnswer = data.question.correct_option.trim().toUpperCase();
                })
                .catch(() => {
                    alert("Backend not running");
                });
        }

        // option selection
        options.forEach(option => {
            option.addEventListener("click", () => {
                options.forEach(opt => opt.classList.remove("selected"));
                option.classList.add("selected");
                selectedOption = option;
            });
        });

        function submitAnswer() {
            if (!selectedOption) {
                alert("Please select an option first!");
                return;
            }

            const userAnswer = selectedOption.dataset.answer.trim().toUpperCase();

            options.forEach(opt => opt.disabled = true);

            if (userAnswer === correctAnswer) {
                selectedOption.classList.add("correct");
                score++;
            } else {
                selectedOption.classList.add("wrong");
                options.forEach(opt => {
                    if (opt.dataset.answer.trim().toUpperCase() === correctAnswer) {
                        opt.classList.add("correct");
                    }
                });

            }

            setTimeout(() => {
                index++;
                loadQuestion();
            }, 1200);
        }

        function finishQuiz() {
            localStorage.setItem("totalQuestions", index);
            localStorage.setItem("correctAnswers", score);

            // optional cleanup
            localStorage.removeItem("selectedCategory");

            // redirect to result page
            window.location.href = "result.html";
        }


        // start quiz
        loadQuestion();
    </script>

</body>

</html>